image: &image
  docker:
    - image: circleci/python

version: 2
jobs:
  build1:
    <<: *image
    steps:
      - run: mkdir lol
      - run: echo "Hello, world!" > workspace/echo-output
      - persist_to_workspace:
          root: workspace
          paths:
            - echo-output
  build2:
    <<: *image
    steps:
      - run: mkdir lol
  build3:
    <<: *image
    steps:
      - run: exit 1
  build4:
    <<: *image
    steps:
      - run: mkdir lol
  build5:
    <<: *image
    steps:
      - run: mkdir lol
      - run: return 1
      - attach_workspace:
          at: /tmp/workspace


workflows:
  version: 2
  build_workflow:
    jobs:
      - build1
      - build2:
          requires:
            - build1
      - build3:
          requires:
            - build1
      - build4:
          requires:
            - build1
      - build5:
          requires:
            - build2
            - build3
            - build4
