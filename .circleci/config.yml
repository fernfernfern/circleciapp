version: 2.1

jobs: # conditional steps may also be defined in `commands:`
  job_with_optional_custom_checkout:
    parameters:
      custom_checkout:
        type: string
        default: ""
    machine: true
    steps:
    - when:
        condition:
          or:
            - and:
              - or:
                  - and:
                      - equal: [ master, << pipeline.git.branch >> ]
                      - equal: [ false, << pipeline.parameters.param1 >> ]
                  - or:
                      - not: << pipeline.parameters.param3 >>
              - or:
                  - equal: [ false, << pipeline.parameters.param3 >> ]
                  - or: [ << pipeline.parameters.param1 >>, << pipeline.parameters.param2 >> ]  
            - or:
                - equal: [ true, << pipeline.parameters.param4 >> ]

        steps:
          - run: echo "param 4 is true OR the other nested conditions are true"
workflows:
  build-test-deploy:
    jobs:
      - job_with_optional_custom_checkout:
          custom_checkout: "any non-empty string is truthy"
      - job_with_optional_custom_checkout
