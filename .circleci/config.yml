version: 2.1
      
jobs:
  job:
    docker:
      - image: cimg/base:stable
    steps:
      - run: |
          commit_message=$(git log -1 HEAD --pretty=format:%s)
          if [[ $commit_message == *"custom-identifier"* ]]; then
          curl --request POST \
            --url https://circleci.com/api/v2/workflow/$CIRCLE_WORKFLOW_ID/cancel \
            --header 'Circle-Token: ${CIRCLE_TOKEN}'
          fi
  job1:
    docker:
      - image: cimg/base:stable
    steps:
      - run: sleep 60
  job2:
    docker:
      - image: cimg/base:stable
    steps:
      - run: exit 1
  job3:
    docker:
      - image: cimg/base:stable
    steps:
      - run: ls /tmp

workflows:
  integration_tests:
    jobs:
      - job
      - job1
      - hold: 
          type: approval 
          requires: 
            - job1
      - job2:
          type: approval
          requires:
            - hold
      - hold2: 
          type: approval 
          requires: 
            - job2
      - job3:
          requires:
            - hold2